<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Network Bash Script</title>
	    <link rel="icon" href="img/s.gif" type="image/x-icon">
    	<link rel="stylesheet" href="css/style.css">
        <script src="js/script.js"></script>
        <!---Alert--->
            <link rel="stylesheet" href="../../../alertify.js-0.3.11/themes/alertify.core.css" />
            <link rel="stylesheet" href="../../../alertify.js-0.3.11/themes/alertify.default.css" />
            <script src="../../../alertify.js-0.3.11/lib/alertify.min.js"></script>        
</head>
<body>
    <div><a href="../../../index.html" title="Home"><img src="img/s.gif" class="s-logo" alt="Main logo."/></a></div>
    	<button class="closeHide" onclick="return(closeWindow());" title="Exit"></button>
    <img src="img/LOADING.gif" class="about-logo" onClick="return(view());" title="About Us" alt="About-us logo."/>
    <h1 align="center" onClick="reloadClear()" title="Refresh">Bash Script for network telnet & ping</h1>
    <div class="script-container">#!/bin/bash

################# COLOR CODES ###################

##echo -e "\e[1:31m This is red text \e[0m"

##Black         0:30    Dark Gray       1:30
##Blue          0:34    Light Blue      1:34
##Green         0:32    Light Green     1:32
##Cyan          0:36    Light Red       1:31
##Red           0:31    Light Cyan      1:36
##Purple        0:35    Light Purple    1:35
##Brown         0:33    Yellow          1:33
##Light Gray    0:37    White           1:37

################################################

LIVE_EMOJI="â¬¤"

NW_C_PORT=443
NW_N_PORT=8080

NW_NAMES=("Google" "facebook" "apple")
NW_IPS=("142.250.70.110" "57.144.124.1" "17.253.144.10")
############################################################
#colors
GREEN="\e[32m"
RED="\e[31m"
YELLOW="\e[33m"
ADVRED="\e[41;1;37m"
ADVGREEN="\e[48;5;236;32m"
ADVGREY="\e[48;5;236;1m"
ADVYELLOW="\e[48;5;236;33m"
BLUE="\e[34m"
RESET="\e[0m"
###########################################################################
clear
echo -e "${BLUE}===============================================${RESET}"
echo -e "\e[0;33;1;44mTELNET & PING DASHBOARD - LATENCY & PACKET LOSS${RESET}"
echo -e "${BLUE}===============================================${RESET}"
printf "\n"
echo -e "\e[0;32m"
read -p "No of PING packets : " PACK
echo -e "\e[0m"
clear
###########################################################################
check() {
        if command -v nc >/dev/null 2>&1; then
                nc -z -w1 "$1" "$2" >/dev/null 2>&1
        else
                timeout 1 bash -c "cat </dev/null >/dev/tcp/$1/$2" >/dev/null 2>&1
        fi
}

# Function to run ping with real-time progress and return full output
ping_with_progress() {
    local ip=$1
    local name=$2
    local count=$PACK
    local received=0
    local full_output=""

    # Show initial loading message directly to the terminal, bypassing buffering.
    printf "  ${ADVRED}[%-7s - Ping]${RESET}\r" "$name" >/dev/tty

    # Use a loop to read the ping output as it's generated
    while read -r line; do
        full_output+="$line"$'\n' # Append line to full_output
        if [[ "$line" == *"bytes from"* ]]; then
            received=$((received+1))
            progress=$(( (received * 100) / count ))
            # Update the progress message directly to the terminal.
            printf "  ${ADVGREEN}[%-10s - %3d%%]${RESET}\r" "$name" "$progress" >/dev/tty
        fi
    done < <(ping -c "$count" -i 0.2 "$ip" 2>&1)

    # Print a carriage return and clear the line to hide the progress bar.
    printf "\r\e[K" >/dev/tty

    # Print the full captured output to be read by the main script
    printf "%s" "$full_output"
}

while true; do
clear
echo "========================"
printf "\e[0;47;30m`date +"%d-%b-%Y %H:%M:%S %p"` \e[0m\n"
echo "========================"
echo " "
printf "\e[0;4;30;46;44;43m`hostname`- `hostname -i `\e[0m\n"
printf "\e[0;33;1;44m---------------------------\e[0m\n"
printf "\e[0;33;1;44mNETWORK CONNECTIVITY STATUS\e[0m\n"
printf "\e[0;33;1;44m---------------------------\e[0m\n"

printf "\e[0;4;30;46;44;43m===========================\e[0m\n"
printf "\e[0;30;46;44;43mALL NETWORKS\e[48;5;236;32;5m $LIVE_EMOJI Live \e[0m\n"

# Header row
for nw_names in "${NW_NAMES[@]}"; do printf "%-16s" "$nw_names";
done
printf "\n"

for ip in "${NW_IPS[@]}"; do printf "%-16s" "$ip";
done
printf "\n"

# Status row with colors
for ip in "${NW_IPS[@]}"; do
        if check "$ip" "$NW_C_PORT"; then
                printf "\033[32m%-16s\033[0m" "UP" # green
        else
                printf "\033[31m%-16s\033[0m" "DOWN" # red
fi
done
printf "\n"

# Header row
for nw_names in "${NW_NAMES[@]}"; do printf "%-16s" "$nw_names";
done
printf "\n"

for ip in "${NW_IPS[@]}"; do printf "%-16s" "$ip";
done
printf "\n"

# Status row with colors
for ip in "${NW_IPS[@]}"; do
        if check "$ip" "$NW_N_PORT"; then
                printf "\033[32m%-16s\033[0m" "UP" # green
        else
                printf "\033[31m%-16s\033[0m" "DOWN" # red fi done printf "\n"
fi
done
printf "\n"

echo -e "\e[0;33;1;44m===================================================${RESET}"
echo -e "\e[0;33;1;44mPING DASHBOARD - LATENCY & PACKET LOSS [$PACK Packets]${RESET}"
echo -e "\e[0;33;1;44m===================================================${RESET}"
echo -e "\e[0m"
echo -e "\e[0;33;1;44mLast updated date `date +"%d-%b-%Y %H:%M:%S %p"`${RESET} \e[48;5;236mSIP:${RESET} ${GREEN}`hostname -i`${RESET} ${ADVGREY}Hostname:${RESET}${ADVYELLOW} `hostname`${RESET}"
printf "\e[48;5;236;32;5m $LIVE_EMOJI Live \e[0m"

LINE1=""

# Header row
echo -e "\e[48;5;236m"
for nw_names in "${NW_NAMES[@]}"; do printf "%-51s" "$nw_names";
done
echo -e "\e[0m"

    # Loop through each IP and show real-time progress
    for ((i=0; i<${#NW_IPS[@]}; i++)); do
        ip="${NW_IPS[$i]}"
        name="${NW_NAMES[$i]}"

        # Call the function to show real-time progress
        # and capture the final output for analysis
        PING=$(ping_with_progress "$ip" "$name")

    # Check if the ping was successful
if [ $? -eq 0 ] && [ -n "$PING" ]; then
    # Extract latency and loss
    LATENCY=$(echo "$PING" | grep 'rtt' | awk -F'/' '{print $5}' | cut -d' ' -f1)
    LOSS=$(echo "$PING" | grep -oP '\d+(?=% packet loss)')

    # Check if LOSS is a number and prioritize packet loss for coloring
    if [[ "$LOSS" =~ ^[0-9.]+$ ]] && (( $(echo "$LOSS > 0" | bc -l) )); then
        COLOR=$RED
    elif [[ "$LATENCY" =~ ^[0-9.]+$ ]] && (( $(echo "$LATENCY > 150" | bc -l) )); then
        COLOR=$YELLOW
    else
        COLOR=$GREEN
    fi

else
    # If ping failed, set latency to --, loss to 100, and color to red
    LATENCY="--"
    LOSS="100"
    COLOR=$RED
fi

        # Build the result string using the variables set in the blocks above
        LINE1+="[${ip}: Latency=${COLOR}${LATENCY}ms${RESET} Packet loss=${COLOR}${LOSS}%${RESET}]  "

done

# Print results horizontally
printf "\n"
echo -e "$LINE1"
printf "\n"
echo -e "\e[48;5;236m                                                                                                                                                                                                                                               \e[0m"
printf "\n"

sleep 0.1

# Prompt for any keypress to continue, or 'n' to exit
echo -e "${YELLOW}Press any key to continue, or 'q' to quit.!${RESET}"
read -s -n 1 choice
printf "\n"

if [[ "$choice" == "q" || "$choice" == "Q" ]]; then
        clear
    break
fi

done

exit;</div>
</body>
</html>
